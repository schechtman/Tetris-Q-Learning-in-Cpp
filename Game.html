<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border: 1px solid #d3d3d3;
    background-color: #f1f1f1;
}
</style>
</head>
<body onload="startGame()">
<script>

var myGamePiece;



function startGame() {
    myGamePiece = new component(30, 30, 0, 50, Math.floor(Math.random()*4+1),0);
    //myGamePiece2 = new component(30, 30, 120, 0, Math.floor(Math.random()*4+1),0);
    myGameArea.start();
    
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function() {
        this.canvas.width = 120;
        this.canvas.height = 180;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        window.addEventListener('keydown', function (e) {
            myGameArea.keys = (myGameArea.keys || []);
            myGameArea.keys[e.keyCode] = true;
        })
        window.addEventListener('keyup', function (e) {
            myGameArea.keys[e.keyCode] = false; 
        })
        this.interval = setInterval(updateGameArea, 20);   
    },
    clear : function(){
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
    //stop : function() {
    //    clearInterval(this.interval);
    //}

}


function component(width, height, x, y,type,xborder) {
    this.width = width;
    this.height = height;
    this.speedX = 0;
    this.speedY = 0;
    this.x = x;
    this.y = y;
    this.type=type;
    this.xborder=0;
    // we give a random colour to the pieces of the game
    color="rgb("+Math.floor(Math.random()*256)+","+Math.floor(Math.random()*256)+","+
  Math.floor(Math.random()*256)+")";
    if (this.type>1)
        {
            this.xborder=this.x+this.width;
        }

    this.update = function(){

        if (this.type==1) {ctx = myGameArea.context;
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
        }
        if (this.type==2)  {
        ctx = myGameArea.context;
        ctx.fillStyle = color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
        ctx.fillRect(this.x+30,this.y,this.width,this.height);
    }


        if (this.type==3) {ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.fillRect(this.x+30,this.y,this.width,this.height);
            ctx.fillRect(this.x,this.y-30,this.width,this.height);
            }
        if (this.type==4) {
            ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.fillRect(this.x+30,this.y,this.width,this.height);
            ctx.fillRect(this.x,this.y-30,this.width,this.height);
            ctx.fillRect(this.x+30,this.y-30,this.width,this.height);


        }
    
    }




    this.newPos = function() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.hitBottom();
        this.hitLeft();
        this.hitRight(); 
    }
    this.hitBottom = function() {
        var rockbottom = myGameArea.canvas.height - this.height;
        if (this.y > rockbottom) {this.y = rockbottom;}
    }
    this.hitLeft = function() {
        var rockleft = 0;
        if (this.x < rockleft) {this.x = rockleft;}
    }
    this.hitRight = function() {
        var rockright = myGameArea.canvas.width-(this.width+this.xborder);
        if (this.x >= rockright) {this.x = rockright;}
    }

}

function updateGameArea() {
    myGameArea.clear();
    myGamePiece.speedX = 0;
    myGamePiece.speedY=1;
    //myGamePiece2.speedX = 0;
    //myGamePiece2.speedY=1;
//    if (myGamePiece.y==450){myGamePiece.speedY=0;}
 //   else {myGamePiece.speedY = +1;}
 //   if (myGamePiece.x==0){myGamePiece.speedX=+20;}
    if (myGameArea.keys && myGameArea.keys[37]) {myGamePiece.speedX = -1; }
    if (myGameArea.keys && myGameArea.keys[39]) {myGamePiece.speedX = 1; }
    if (myGameArea.keys && myGameArea.keys[38]) {myGamePiece.speedY = -1; }
    if (myGameArea.keys && myGameArea.keys[40]) {myGamePiece.speedY = 1; }
    myGamePiece.newPos();
    myGamePiece.update();
    //myGamePiece2.newPos();
    //myGamePiece2.update();
}


function moveup() {
    myGamePiece.speedY -= 1; 
}

function movedown() {
    //if (myGamePiece.y>=450){myGamePiece.speedY-=10;}
    //else {myGamePiece.speedY += 1;}
    myGamePiece.speedY += 1;

}

function moveleft() {
    myGamePiece.speedX -= 1;
}

function moveright() {
    myGamePiece.speedX += 1;
}

function stopMove() {
    myGamePiece.speedX = 0;
    myGamePiece.speedY = 0; 
}



</script>


<p>Tentative de TETRIS</p>

</body>
</html>